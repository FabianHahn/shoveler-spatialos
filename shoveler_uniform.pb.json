{
  "identifier": {
    "name": "shoveler"
  },
  "projectId": {
    "name": "loom"
  },
  "assembly": {
    "name": "shoveler-bots-21.01.2022"
  },
  "initialState": {
    "taggedSnapshot": {
      "historyName": "shoveler",
      "snapshotTag": "shoveler-tiles-21.01.2022"
    }
  },
  "lifetime": {
    "seconds": "2400"
  },
  "launchConfiguration": {
    "template": "w2_r0500_e5",
    "world": {
      "chunkEdgeLengthMeters": "10",
      "legacyFlags": [
        {
          "name": "long_tick_threshold_ms",
          "value": "10"
        },
        {
          "name": "load_snapshot_at_startup",
          "value": "true"
        },
        {
          "name": "max_concurrent_workers",
          "value": "4096"
        },
        {
          "name": "drive_shunt",
          "value": "false"
        },
        {
          "name": "num_threads",
          "value": "4"
        },
        {
          "name": "shunt_tcp_shard_count",
          "value": "1"
        },
        {
          "name": "shunt_udp_shard_count",
          "value": "8"
        },
        {
          "name": "shunt_udp_socket_count",
          "value": "1"
        }
      ],
      "dimensions": {
        "xMeters": "200",
        "zMeters": "200"
      }
    },
    "load_balancing": {
      "layer_configurations": [
        {
          "layer": "ShovelerServer",
          "rectangle_grid": {
            "cols": 1,
            "rows": 1
          }
        }
      ]
    },
    "workers": [
      {
        "workerType": "ShovelerClient",
        "flags": [
          {
            "name": "controller_frame_position",
            "value": "0 0 5"
          },
          {
            "name": "controller_frame_direction",
            "value": "0 0 -1"
          },
          {
            "name": "controller_frame_up",
            "value": "0 1 0"
          },
          {
            "name": "controller_move_factor",
            "value": "2.0"
          },
          {
            "name": "controller_bounding_box_2d_size",
            "value": "0.9"
          },
          {
            "name": "controller_lock_move_z",
            "value": "false"
          },
          {
            "name": "controller_lock_tilt_x",
            "value": "true"
          },
          {
            "name": "controller_lock_tilt_y",
            "value": "true"
          },
          {
            "name": "position_mapping_x",
            "value": "+x"
          },
          {
            "name": "position_mapping_y",
            "value": "+z"
          },
          {
            "name": "position_mapping_z",
            "value": "+y"
          },
          {
            "name": "hide_player_client_entity_model",
            "value": "false"
          },
          {
            "name": "game_type",
            "value": "tiles"
          }
        ],
        "permissions": [
          {
            "all": {}
          }
        ]
      },
      {
        "workerType": "ShovelerServer",
        "flags": [
          {
            "name": "game_type",
            "value": "tiles"
          }
        ],
        "permissions": [
          {
            "all": {}
          }
        ]
      },
      {
        "workerType": "ShovelerBotClient",
        "flags": [
          {
            "name": "starting_chunk_min_x",
            "value": "0"
          },
          {
            "name": "starting_chunk_min_z",
            "value": "0"
          },
          {
            "name": "starting_chunk_size_x",
            "value": "20"
          },
          {
            "name": "starting_chunk_size_z",
            "value": "20"
          }
        ],
        "permissions": [
          {
            "all": {}
          }
        ]
      }
    ]
  },
  "genericClientNodes": [
    {
      "name": "bots_a",
      "size": "octa",
      "config": {
        "command": {
          "assemblyZip": "LauncherClient@Linux.zip",
          "path": "mono",
          "args": [
            "BashWrapper.exe",
            "./bot.sh",
            "450",
            "bots_a_",
            "{receptionist_ip}",
            "{receptionist_port}"
          ]
        },
        "instances": 1
      }
    },
    {
      "name": "bots_b",
      "size": "octa",
      "config": {
        "command": {
          "assemblyZip": "LauncherClient@Linux.zip",
          "path": "mono",
          "args": [
            "BashWrapper.exe",
            "./bot.sh",
            "450",
            "bots_b_",
            "{receptionist_ip}",
            "{receptionist_port}"
          ]
        },
        "instances": 1
      }
    },
    {
      "name": "bots_c",
      "size": "octa",
      "config": {
        "command": {
          "assemblyZip": "LauncherClient@Linux.zip",
          "path": "mono",
          "args": [
            "BashWrapper.exe",
            "./bot.sh",
            "450",
            "bots_c_",
            "{receptionist_ip}",
            "{receptionist_port}"
          ]
        },
        "instances": 1
      }
    }
  ],
  "metrics": [
    {
      "name": "view_lateness_full",
      "initialDelaySeconds": 30,
      "prometheusExpressionTemplate": "spatialos_bridge_view_lateness_ms::summary5m{app='%project%',dpl='%deployment%',quantile='0.90'}",
      "fallback": {"valueFallback": {"value": 0}}
    },
    {
      "name": "shunt_queueing_latency",
      "initialDelaySeconds": 30,
      "prometheusExpressionTemplate": "histogram_quantile(0.90, sum(rate(shunt_queue_latency_bucket{app='%project%',dpl='%deployment%'}[5m])) by (le))",
      "fallback": {"valueFallback": {"value": 0}}
    },
    {
      "name": "state_synchroniser_event_latency",
      "initialDelaySeconds": 30,
      "prometheusExpressionTemplate": "histogram_quantile(0.90, sum(rate(state_synchroniser_event_latency_bucket{app='%project%',dpl='%deployment%'}[5m])) by (le))",
      "fallback": {"valueFallback": {"value": 0}}
    },
    {
      "name": "clients_connected",
      "initialDelaySeconds": 900,
      "prometheusExpressionTemplate": "spatialos_worker_connected::sum{project='%project%', dpl='%deployment%', worker_type='ShovelerBotClient'}",
      "fallback": {"valueFallback": {"value": 0}}
    },
    {
      "name": "player_updates",
      "initialDelaySeconds": 900,
      "prometheusExpressionTemplate": "improbable_bridge_upstream_message::rate1m_sum{project='%project%', dpl='%deployment%',node_cat=''}",
      "fallback": {"valueFallback": {"value": 0}}
    }
  ],
  "expectations": [
    {
      "name": "view_lateness_is_low",
      "metricExpectation": {
        "metricName": "view_lateness_full",
        "maxValue": {"value": 10}
      }
    },
    {
      "name": "shunt_queueing_latency_is_low",
      "metricExpectation": {
        "metricName": "shunt_queueing_latency",
        "maxValue": {"value": 100}
      }
    },
    {
      "name": "state_synchroniser_event_latency_is_low",
      "metricExpectation": {
        "metricName": "state_synchroniser_event_latency",
        "maxValue": {"value": 250}
      }
    },
    {
      "name": "clients_are_sending_updates",
      "metricExpectation": {
        "minValue": {"value": 3000},
        "metricName": "player_updates"
      }
    },
    {
      "name": "all_clients_connected",
      "metricExpectation": {
        "minValue": {"value": 100},
        "metricName": "clients_connected"
      }
    }
  ]
}
